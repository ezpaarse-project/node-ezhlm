# node-ezhlm

**Table of content**
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Global options](#global-options)
- [Command line usage](#command-line-usage)
- [Commands](#commands)

## Prerequisites

The tools you need to let node-ezhlm run are :
* Linux
* elastic instance up
* npm
* node 14.15.2

## Installation

```bash
git clone https://github.com/ezpaarse-project/node-ezhlm
cd node-ezhlm
npm i -g .
```

 ## Global options
| Name | Type | Description |
| --- | --- | --- |
| -V, --version | Boolean | Print the version number |
| -h, --help | Boolean | Show some help |

You can get help for any command by typing `node-ezhlm <command> --help`.

## Command line usage
The module provides an `ezhlm` command.

## Commands

- [config](#ezhlm-config)
- [ping](#ezhlm-ping)
- [create-index](#ezhlm-create-index)
- [reset](#ezhlm-reset)
- [insertFromHLM](#ezhlm-insertfromhlm)
- [enrichFromHoldings](#ezhlm-enrichfromholdings)
- [updateFromMarc](#ezhlm-updatefrommarc)

### ezhlm config
Update config to fetch ez-meta.
The default configuration is saved in a file at $HOME/.config/ezhlm.json
#### parameters
| Name | Description |
| --- | --- |
| -g --get | display the configuration of $HOME/.config/ezhlm.json |
| -s --set | initiate a configuration file at $HOME/.config/ezhlm.json |
#### Example
```bash
ezhlm config --set elastic.baseURL http://elastic.com
```
output
```bash
{
  "elastic": {
    "baseURL": "http://elastic.com",
    "username": "elastic",
    "password": "changeme"
  },
  "holdingsiq": {
    "baseURL": "https://api.com",
    "institutes": [
      {
        "name": "institute",
        "custid": "custid",
        "apikey": "apikey"
      }
      {
        ...
        ...
        ...
      }
    ]
  }
}
info: from /home/.config/ezhlm.json
```
### ezhlm ping

Check if service is available.

#### Example
```bash
ezhlm ping
```

output
```bash
info: service available http://localhost:9200
```
### ezhlm create-index

initiates the ezhlm index with this [mapping](https://github.com/ezpaarse-project/node-ezhlm/blob/master/index/ezhlm.json) 

#### Parameter
| Nom | Description |
| --- | --- |
| i --index | index name  |
#### Example

```bash
ezhlm create-index ezhlm-2022
```
output
```bash
info: [ezhlm-2022] index has created
```
### ezhlm reset
empty ezhlm index on ez-meta.

#### Example
```bash
ezhlm reset --index ezhlm-2022
```

output
```bash
info: [ezhlm-2022] is reseted
```
### ezhlm insertFromHLM
before use this command, make sure ezhlm is created.

Insert data from csv files generated by HLM
#### Parameters

| Name | Description |
| --- | --- |
| -f --folder | folder that content HLM files |
| -i --index | index to wich insert the content of folder |
| -d --date | date of HLM data at YYYY-mm-dd format |
#### Example
```bash
ezhlm insertFromHLM --folder ./2022
```
output
```bash
info: lines that must be inserted 437329
progress [========================================] 100% | 270929541/270929541 bytes
info: 437329/437329 lines inserted
```

### ezhlm updateFromMarc

(beta)

Harvest all the data from the HoldingsIQ API for each
institution to enrich the existing

### ezhlm enrichFromHoldings

(beta)

Enriches the ezhlm index data by creating ezhlm-id according 
to the XML file content (from Marc Update) and enriches these id with the holdingsIQ AP
#### Parameters

| Name | Description |
| --- | --- |
| -f --file | xml file |


## dev


```bash
# Execute this one time
docker-compose -f docker-compose.debug.yml run --rm elastic chown -R elasticsearch /usr/share/elasticsearch/ 

# Start readholdings as daemon
docker-compose -f docker-compose.debug.yml up -d

# Stop readholdings
docker-compose -f docker-compose.debug.yml stop

# Get the status of readholdings services
docker-compose -f docker-compose.debug.yml ps
```
