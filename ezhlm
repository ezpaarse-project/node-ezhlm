#!/usr/bin/env node

const program = require('commander');
const pkg = require('./package.json');

const logger = require('./lib/logger');

const { manageConfig } = require('./cmds/config');
const { ping } = require('./cmds/ping');
const insertFromHLM = require('./cmds/hlm');
const { enrichFromHoldings, updateFromHoldings } = require('./cmds/ebsco');
const { resetIndex, createIndex } = require('./cmds/elastic');

program.on('command:*', () => {
  logger.error(`Invalid command: ${program.args.join(' ')}\nSee --help for a list of available commands.`);
  process.exit(1);
});

program.version(pkg.version);

program
  .command('config')
  .description('config management command to establish the connection between the command and ez-meta')
  .option('-g --get', 'display the configuration')
  .option('-s --set <key> <value>', 'update config')
  .option('-L --list', 'list of attributes required for configuration')
  .action((options) => manageConfig(options));

program
  .command('ping')
  .description('Check if service is available')
  .action((options) => ping(options));

program
  .command('create-index')
  .description('create elastic index with ezhlm mapping')
  .option('-i --index <index>', 'index')
  .action((options) => createIndex(options));

program
  .command('reset')
  .description('Empty elastic index')
  .option('-i --index <index>', 'index')
  .action((options) => resetIndex(options));

program
  .command('insertFromHLM')
  .description('Insert data from csv files generated by HLM')
  .option('-f --folder <folder>', 'folder that content HLM files')
  .option('-i --index <index>', 'index to wich insert the content of folder')
  .option('-d --date <date>', 'date of HLM data')
  .action((options) => insertFromHLM(options));

program
  .command('enrichFromHoldings')
  .description('Harvest all the data from the HoldingsIQ API for each institution to enrich the existing')
  .action((options) => enrichFromHoldings(options));

program
  .command('updateFromHoldings')
  .description('Enriches the ezhlm index data by creating ezhlm-id according to the XML file content (from Marc Update) and enriches these id with the holdingsIQ API')
  .option('-f --file <file>', 'xml file')
  .action((options) => updateFromHoldings(options));

program.parse(process.argv);
